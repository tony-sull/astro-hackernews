---
import Comment from "../../components/Comment.astro";
import For from "../../components/For.astro";
import Show from "../../components/Show.astro";
import Layout from "../../layouts/Base.astro";
import fetchAPI from "../../lib/api";
import type { IComment, IStory } from "../../types.js";

const { id } = Astro.params as { id: string };

const story = (await fetchAPI(`item/${id}`)) as IStory;
---

<Layout>
  <div class="item-view">
    <div class="item-view-header">
      <a href={story.url} target="_blank">
        <h1>{story.title}</h1>
      </a>
      <Show when={story.domain}>
        <span class="host">({story.domain})</span>
      </Show>
      <p class="meta">
        {story.points} points | by <a href={`/users/${story.user}`}
          >{story.user}</a
        >&nbsp;
        {story.time_ago} ago
      </p>
    </div>
    <div class="item-view-comments">
      <p class="item-view-comments-header">
        {
          story.comments_count
            ? story.comments_count + " comments"
            : "No comments yet."
        }
      </p>
      <ul class="comment-children">
        <For each={story.comments}>{(comment: IComment) => <Comment comment={comment} />}</For>
      </ul>
    </div>
  </div>
</Layout>
